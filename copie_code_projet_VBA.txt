Dim carte_ennemi, carte_allie As Range
Dim col_cible, ligne_cible, col_ordi, ligne_ordi, ligne, colonne As Integer
Dim tour, p_a_ennemi_sens, c_ennemi_sens, c_t_ennemi_sens, s_m_ennemi_sens, a_c_ennemi_sens, p_a_allie_sens, c_allie_sens, c_t_allie_sens, s_m_allie_sens, a_c_allie_sens, bateau_sens, bateau_nom As String
Dim p_a_allie, p_a_ennemi, c_allie, c_ennemi, c_t_allie, c_t_ennemi, s_m_allie, s_m_ennemi, a_c_allie, a_c_ennemi, bateau As Range
' p_a = porte-avions (5 cases)
' c = cuirassé (4 cases)
' c_t = contre torpillieur (3 cases)
' s_m = sous marin (3 cases)
' a_c = avion de chasse (2 cases)
Dim alphabet As String
Dim bateau_touche As Boolean





Sub lancer_partie()
'Florian

    'initialisation des plages de cellules des cartes énnemie et alliée
    Set carte_ennemi = Range("U4:AD13")
    Set carte_allie = Range("E4:N13")
    alphabet = "ABCDEFGHIJ"

    def_range_bateau

    'on met ou remmet la feuille de calcul pour etre prete à debuter une partie
    carte_allie.ClearContents
    carte_ennemi.ClearContents

    carte_allie.Interior.Color = RGB(51, 204, 255)
    carte_ennemi.Interior.Color = RGB(51, 204, 255)

    p_a_allie.Interior.Color = RGB(153, 153, 153)
    c_allie.Interior.Color = RGB(153, 153, 153)
    c_t_allie.Interior.Color = RGB(153, 153, 153)
    s_m_allie.Interior.Color = RGB(153, 153, 153)
    a_c_allie.Interior.Color = RGB(153, 153, 153)
    
    sens
    'Appel de la fonction pour connaitre le sens des bateaux

    MsgBox ("Explication pour l'utilisateur")
    'régiger un message pour expliquer a l'utilisateur les regle la manière de jouer

    tour = "utilisateur"
    'la varriable tour vaut soit "utilisateur" lorsque c'est à l'utilisateur de jouer soit "ordinateur" lorsque c'est à l'utilasateur de jouer
    '--> !!! elle n'est initialisé que lorsque l'utilisateur lance une partie en cliquant sur la bouton donc tant que cette variable ne vaut pas "utilisateur" ou "ordinateur il ne doit rien ce passer sur VBA !


End Sub

Sub def_range_bateau()
'Florian
'place dans différentes range les positions de chaques bateaux sur la feuille de travail

    'initialisation des plages de cellules de chaque bateau allie
    Set p_a_allie = Range("G12:K12")
    Set c_allie = Range("G5:G8")
    Set c_t_allie = Range("L8:L10")
    Set s_m_allie = Range("J6:L6")
    Set a_c_allie = Range("E10:E11")

    'initialisation des plages de cellules de chaque bateau ennemie
    Set p_a_ennemi = Range("X7:X11")
    Set c_ennemi = Range("AC7:AC10")
    Set c_t_ennemi = Range("AB5:AD5")
    Set s_m_ennemi = Range("Z4:Z6")
    Set a_c_ennemi = Range("U4:V4")


End Sub

Sub tour_allie()
'ensemble des action qui on lieu lorsque durant sont tours l'utilisateur clique sur le bouton "Feu!"
    Dim reponse As String
    
    If col_cible > 0 And col_cible <= 10 And ligne_cible > 0 And ligne_cible <= 10 Then
        reponce = test_touche()
        Call message(reponce, tour, col_cible, ligne_cible)
        Call modifie_case(reponce, tour, col_cible, ligne_cible)
        tour = "ordinateur"
        Call tour_ennemi
    Else
        MsgBox ("Veuiller selectioner une cible valide")
    End If
    
End Sub

Sub tour_ennemi()
'ensemble des action qui on lieu apres le tours de l'utilisateur lorsque c'est le tout de l'ennemi

    Dim reponce As String
    
    
    
    Randomize
    col_cible = Int(10 * Rnd) + 1
    ligne_cible = Int(10 * Rnd) + 1
    
    reponce = test_touche()
    Call message(reponce, tour, col_cible, ligne_cible)
    Call modifie_case(reponce, tour, col_cible, ligne_cible)
    tour = "utilisateur"

End Sub

Sub sens()
'Renvoie le sens des bateaux ("H" horizontal et "V" vertical)
'Arnaud
'Paramètres: "tour" - tour du joueur ou de l'ordinateur
'            "nom-bateau_ennemi/allie" - Plage des bateaux concernés
'Sortie: "bateau_sens" - "V" s'il est sur la verticale, "H" pour l'horizontale

'Méthode: Compter le nombre de colonnes concernées par chaque bateau, s'il n'y en a qu'une, c'est qu'il est placé à la verticale, sinon à l'horizontale

'Initialisation: Premier bateau
Set bateau = p_a_ennemi

For i = 1 To 10

'   Boucle de test de sens
    If bateau.Columns.Count = 1 Then
        bateau_sens = "V"
    Else
        bateau_sens = "H"
    End If

'   Changement de bateau à tour de rôle
    If i = 10 Then
        a_c_allie_sens = bateau_sens
    ElseIf i = 9 Then
        s_m_allie_sens = bateau_sens
        Set bateau = a_c_allie
    ElseIf i = 8 Then
        c_t_allie_sens = bateau_sens
        Set bateau = s_m_allie
    ElseIf i = 7 Then
        c_allie_sens = bateau_sens
        Set bateau = c_t_allie
    ElseIf i = 6 Then
        p_a_allie_sens = bateau_sens
        Set bateau = c_allie
    ElseIf i = 5 Then
        a_c_ennemi_sens = bateau_sens
        Set bateau = p_a_allie
    ElseIf i = 4 Then
        s_m_ennemi_sens = bateau_sens
        Set bateau = a_c_ennemi
    ElseIf i = 3 Then
        c_t_ennemi_sens = bateau_sens
        Set bateau = s_m_ennemi
    ElseIf i = 2 Then
        c_ennemi_sens = bateau_sens
        Set bateau = c_t_ennemi
    ElseIf i = 1 Then
        p_a_ennemi_sens = bateau_sens
        Set bateau = c_ennemi
    End If

Next i

End Sub


Function test_touche() As String
'fonction qui teste si la case ciblée par un des deux joureur correspond a celle q'un bateau ennemie si oui renvoi le nom de ce bateau si non renvois "non_touche"
'Arnaud

'paramètre: "bateau_ennemi" - Prendre la plage de chaque bateau, un par un
'           "bateau_ennemi_sens" - Prendre le sens de chaque bateau, un par un
'           "bateau_nom" - Donner le nom du bateau touché
'           "bateau_touche" - Renvoie si un bateau a été touché
'           "tour" - Vérifier qu'il s'agisse du tour du joueur ou de l'ordinateur
'           "ligne_cible" - Ligne visée
'           "col_cible" - Colonne visée
'Sortie: donne les coordonnées si bateau touché
'(Prérequis: avoir lancé la fonction sens au moins une fois avant)

    'Réinitialisation de la variable en début de test
    bateau_touche = False
    test_touche = "non_touche"

    'Initialisation: premier bateau
    If tour = "utilisateur" Then
        Set bateau = p_a_ennemi
        bateau_sens = p_a_ennemi_sens
        bateau_nom = "Porte-avions"
    ElseIf tour = "ordinateur" Then
        Set bateau = p_a_allie
        bateau_sens = p_a_allie_sens
        bateau_nom = "Porte-avions"
    End If
    
        For i = 1 To 5
    
            For j = 1 To bateau.Count
    
                If tour = "utilisateur" Then
    
    'En fonction du sens, on vérifie la plage de chaque bateau à la verticale ou l'horizontale
    'On compare avec la case ciblée

                        If bateau.Cells(j).Address = carte_ennemi.Cells(ligne_cible, col_cible).Address Then
                            ligne = ligne_cible
                            colonne = col_cible
                            bateau_touche = True
                            'MsgBox bateau_nom & " : ligne: " & ligne & "colonne: " & colonne
                            test_touche = bateau_nom
                        End If

                
            ElseIf tour = "ordinateur" Then
        
                        If bateau.Cells(j).Address = carte_allie.Cells(ligne_cible, col_cible).Address Then
                            ligne = ligne_cible
                            colonne = col_cible
                            bateau_touche = True
                            'MsgBox bateau_nom & " : ligne: " & ligne & "colonne: " & colonne
                            test_touche = bateau_nom
                        End If
        
            End If
           
            Next j
    
    'On change de bateau à vérifier en fonction du tour
    
             If tour = "utilisateur" Then
            If i = 4 Then
                Set bateau = a_c_ennemi
                bateau_sens = a_c_ennemi_sens
                bateau_nom = "avion de chasse ennemi"
            ElseIf i = 3 Then
                Set bateau = s_m_ennemi
                bateau_sens = s_m_ennemi_sens
                bateau_nom = "sous-marin ennemi"
            ElseIf i = 2 Then
                Set bateau = c_t_ennemi
                bateau_sens = c_t_ennemi_sens
                bateau_nom = "contre-torpilleur ennemi"
            ElseIf i = 1 Then
                Set bateau = c_ennemi
                bateau_sens = c_ennemi_sens
                bateau_nom = "cuirassé ennemi"
            End If
            
        ElseIf tour = "ordinateur" Then
            If i = 4 Then
                Set bateau = a_c_allie
                bateau_sens = a_c_allie_sens
                bateau_nom = "avion de chasse allié"
            ElseIf i = 3 Then
                Set bateau = s_m_allie
                bateau_sens = s_m_allie_sens
                bateau_nom = "sous-marin allié"
            ElseIf i = 2 Then
                Set bateau = c_t_allie
                bateau_sens = c_t_allie_sens
                bateau_nom = "contre-torpilleur allié"
            ElseIf i = 1 Then
                Set bateau = c_allie
                bateau_sens = c_allie_sens
                bateau_nom = "cuirassé allié"
            End If
    
        End If

    Next i

test_detruit
End Sub

Sub test_detruit()
'Jules
'lorsque un bateau est touché test si ce bateau est détruit

Dim j As Integer
j = 0

For i = 1 To a_c_ennemi.Count
   If a_c_ennemi_sens = "V" Then
       If a_c_ennemi.Cells(i, 1).Value = " " Then
            j = j + 1
        End If
    ElseIf a_c_ennemi_sens = "H" Then
        If a_c_ennemi.Cells(1, i).Value = " " Then
            j = j + 1
        End If
    End If
Next i

If j = a_c_ennemi.Count Then
    MsgBox ("Avion de chasse détruit")
End If

j = 0

For i = 1 To p_a_ennemi.Count
   If p_a_ennemi_sens = "V" Then
       If p_a_ennemi.Cells(i, 1).Value = " " Then
            j = j + 1
        End If
    ElseIf p_a_ennemi_sens = "H" Then
        If p_a_ennemi.Cells(1, i).Value = " " Then
            j = j + 1
        End If
    End If
Next i

If j = p_a_ennemi.Count Then
    MsgBox ("Porte-avion détruit")
End If

j = 0

For i = 1 To c_t_ennemi.Count
   If c_t_ennemi_sens = "V" Then
       If c_t_ennemi.Cells(i, 1).Value = " " Then
            j = j + 1
        End If
    ElseIf c_t_ennemi_sens = "H" Then
        If c_t_ennemi.Cells(1, i).Value = " " Then
            j = j + 1
        End If
    End If
Next i

If j = c_t_ennemi.Count Then
    MsgBox ("Contre-torpilleur détruit")
End If

j = 0

For i = 1 To s_m_ennemi.Count
   If s_m_ennemi_sens = "V" Then
       If s_m_ennemi.Cells(i, 1).Value = " " Then
            j = j + 1
        End If
    ElseIf s_m_ennemi_sens = "H" Then
        If s_m_ennemi.Cells(1, i).Value = " " Then
            j = j + 1
        End If
    End If
Next i

If j = s_m_ennemi.Count Then
    MsgBox ("Sous-marin détruit")
End If

j = 0

For i = 1 To c_ennemi.Count
   If c_ennemi_sens = "V" Then
       If c_ennemi.Cells(i, 1).Value = " " Then
            j = j + 1
        End If
    ElseIf c_ennemi_sens = "H" Then
        If c_ennemi.Cells(1, i).Value = " " Then
            j = j + 1
        End If
    End If
Next i

If j = c_ennemi.Count Then
    MsgBox ("Cuirassé détruit")
End If


End Sub

Sub test_gagne()
'Omar
'lorsque un bateau est détuit teste qui tout les autres sont détruit au quelle cas le joureurs gagne

End Sub

Sub modifie_case(ByVal Touche As String, ByVal tour As String, ByVal colonne As Integer, ByVal ligne As Integer)
'Florian
'modifie  les carratésitique de la case ciblé pour faire comprendre au joueur si il a touché un bateu énemie, si il n'a rien touché ou si un de ces bateau à été détruit

'-->pour le moment on se contente de changer la couleur de la case ou d'afficher une croix en l'attente de sprite

'parametre : "touche" --> Si le coup n'a rien touché mettre "non_touche"
'                         Si le coup a touché, mettre le nom du bateau touché (Porte avions, Cuirassé, Contre torpilleur, Sous marin, Avion de chasse)
'            "tour"   --> Mettre le joueur qui vien de jouer "utilisateur" ou "ordinateur"
'            "collone"--> Numéro de la collone dans la gille de jeu qui été ciblé
'            "ligne"  --> Numéro de la ligne dans la grille de jeu qui à été ciblé
'sortie: modifie la couleur de la case qui as été touché

    If Touche = "non_touche" Then
                                If tour = "utilisateur" Then
                                                            carte_ennemi.Cells(ligne, colonne).Value = "X"
                                ElseIf tour = "ordinateur" Then
                                                            carte_allie.Cells(ligne, colonne).Value = "X"
                                End If
                            Else
                                If tour = "utilisateur" Then
                                                            carte_ennemi.Cells(ligne, colonne).Interior.Color = RGB(235, 52, 52)
                                ElseIf tour = "ordinateur" Then
                                                            carte_allie.Cells(ligne, colonne).Interior.Color = RGB(235, 52, 52)
                                End If
    End If

End Sub

Sub fin_partie()
'lorsque l'un des joueurs à gangé affiche un message de fin de partie ansi que des statisique de la partie

End Sub

Sub message(ByVal Touche As String, ByVal tour As String, ByVal colonne As Integer, ByVal ligne As Integer)
'Florian
'fontion qui affiche un message à l'utilisatuer en fonction du coup qu'il vien de jouer ou que l'ordinateur vien de jouer
'parametre : "touche" --> Si le coup n'a rien touché mettre "non_touche"
'                         Si le coup a touché, mettre le nom du bateau touché (Porte avions, Cuirassé, Contre torpilleur, Sous marin, Avion de chasse)
'            "tour"   --> Mettre le joueur qui vien de jouer "utilisateur" ou "ordinateur"
'            "collone"--> Numéro de la collone dans la gille de jeu qui été ciblé
'            "ligne"  --> Numéro de la ligne dans la grille de jeu qui à été ciblé
'sortie : affichage d'un MsgBox correspondant a la description du tour
    Dim contenu As String
    Dim colonne_alpha As String
    'lettre correspondant a la collone dans le grille de jeu
    colonne_alpha = Mid(alphabet, colonne, 1)
    If Touche = "non_touche" Then
                                If tour = "utilisateur" Then
                                                                contenu = colonne_alpha & ligne & " aucun bateau ennemi touché..."
                                ElseIf tour = "ordinateur" Then
                                                                contenu = colonne_alpha & ligne & " aucun bateau allié touché !"
                                End If
                            Else
                                If tour = "utilisateur" Then
                                                                contenu = colonne_alpha & ligne & " " & Touche & " " & " ennemi touché !"
                                ElseIf tour = "ordinateur" Then
                                                                contenu = colonne_alpha & ligne & " " & Touche & " " & " allié touché..."
                                End If
    End If


    Call MsgBox(contenu, , "Récapitulatif du tour")
    'MsgBox (touche & tour & collone & ligne)


End Sub


Private Sub Worksheet_SelectionChange(ByVal Target As Range)
'Florian
'lorsque lorsque durant sont tours, l'utilisateur selectionne ( clique ou déplace avec les flèche directinel) une case de la carte énnemi
'met les coordoné choisie dans deux variables "coll_cible" et "ligne_cible" et affiche a l'utilisateur la cible en I15 de manière lisible pour lui

    Dim i, j As Integer

    If tour = "utilisateur" Then
        For i = 1 To 10
            For j = 1 To 10
                If Target.Address = carte_ennemi.Cells(i, j).Address Then
                    col_cible = j
                    ligne_cible = i
                End If
            Next j
        Next i

        Range("I15").Value = Mid(alphabet, col_cible, 1) & " " & ligne_cible
    End If
End Sub




